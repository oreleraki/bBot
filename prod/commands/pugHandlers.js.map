{"version":3,"sources":["../../src/commands/pugHandlers.js"],"names":["pugEventEmitter","events","EventEmitter","Pug","name","noOfPlayers","noOfTeams","pickingOrder","turn","picking","players","captains","timer","user","findPlayer","push","team","captain","pick","tag","rating","playerIndex","findIndex","p","id","splice","stopPug","serverId","setTimeout","remaining","length","playersWithoutCaptain","filter","poolForCaptains","slice","sort","a","b","leastDiff","pair","i","left","diff","Math","abs","right","smallest","min","firstCaptain","secondCaptain","fillCaptainSpot","find","u","otherCaptainIndex","otherCaptain","console","log","otherCaptainTeam","pIndex","didFillSpot","emit","pugEvents","captainsReady","captainTimeout","teamIndex","areCaptainsDecided","clearTimeout","captainsDecided","pickedPlayers","player","lastPlayerIndex","lastPlayerTeam","finished","cleanup","Boolean","forEach","addGameType","channel","gameName","roles","privilegedRoles","isNaN","send","state","store","getState","gameTypes","pugs","some","g","toLowerCase","parseInt","newGameType","GameTypes","findOneAndUpdate","server_id","$push","game_types","exec","dispatch","delGameType","rest","updatedGameTypes","listGameTypes","_","__","pugChannel","list","tempList","map","maxPlayers","gamesList","reduce","acc","curr","existingPug","guild","listAllCurrentGameTypes","joinGameTypes","args","username","isPartOfFilledPug","toUpperCase","toBroadcast","statuses","game","gameType","joined","pug","hasFilledBeforeJoining","addPlayer","fillPug","hasFilledAfterJoining","newPug","activeCount","allLeaveMsgs","op","allPugLeaveMsgs","j","leaveGameTypes","msg","isOffline","returnStatus","isInPug","removePlayer","deadPugs","isEmpty","leaveStatus","leaveAllGameTypes","message","hasGoneOffline","offline","listToLeave","addCaptain","forWhichPug","isCandidate","result","pickPlayer","index","alreadyPicked","pugPicking","pugsInPicking","adminAddPlayer","mentionedUser","adminRemovePlayer","adminPickPlayer"],"mappings":"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","sourcesContent":["import store from '../store';\nimport { GameTypes } from '../models';\nimport {\n  computePickingOrder,\n  hasPrivilegedRole,\n  shuffle,\n  getRandomInt,\n} from '../utils';\nimport {\n  privilegedRoles,\n  captainTimeout,\n  offline,\n  pugEvents,\n} from '../constants';\nimport {\n  formatListGameTypes,\n  formatJoinStatus,\n  formatLeaveStatus,\n  formatBroadcastPug,\n  formatListAllCurrentGameTypes,\n  formatAddCaptainStatus,\n  formatPugsInPicking,\n  formatDeadPugs,\n  formatPickPlayerStatus,\n} from '../formats';\nimport { assignGameTypes, addNewPug, removePug } from '../store/actions';\nimport events from 'events';\n\nexport const pugEventEmitter = new events.EventEmitter();\n\nclass Pug {\n  constructor({ name, noOfPlayers, noOfTeams, pickingOrder }) {\n    this.name = name;\n    this.noOfPlayers = noOfPlayers;\n    this.noOfTeams = noOfTeams;\n    this.pickingOrder = pickingOrder;\n    this.turn = 0;\n    this.picking = false;\n    this.players = [];\n    this.captains = [];\n    this.timer = null;\n  }\n\n  // 0 if couldn't join, 1 if joined, 2 if already in\n  addPlayer(user) {\n    if (!this.picking) {\n      if (this.findPlayer(user)) return 2;\n      this.players.push({\n        team: null,\n        captain: null,\n        pick: null,\n        tag: null,\n        rating: 0,\n        ...user,\n      });\n      return 1;\n    }\n    return 0;\n  }\n\n  removePlayer(user) {\n    const playerIndex = this.players.findIndex(p => p.id === user.id);\n    this.players.splice(playerIndex, 1);\n    if (this.picking) this.stopPug();\n  }\n\n  fillPug(serverId) {\n    this.picking = true;\n    this.timer = setTimeout(() => {\n      const remaining = this.noOfPlayers - this.captains.length;\n      const playersWithoutCaptain = this.players.filter(\n        p => p.captain === null\n      );\n      const poolForCaptains = shuffle(playersWithoutCaptain)\n        .slice(0, remaining * 0.8)\n        .sort((a, b) => a.rating - b.rating);\n\n      if (this.noOfTeams === 2) {\n        if (this.captains.length === 0) {\n          let leastDiff = 0;\n          let pair = [0, 1];\n          for (let i = 1; i < poolForCaptains.length - 1; i++) {\n            const left = {\n              pair: [i, i - 1],\n              diff: Math.abs(\n                poolForCaptains[i].rating - poolForCaptains[i - 1].rating\n              ),\n            };\n            const right = {\n              pair: [i, i + 1],\n              diff: Math.abs(\n                poolForCaptains[i].rating - poolForCaptains[i + 1].rating\n              ),\n            };\n\n            const smallest = Math.min(left.diff, right.diff);\n            if (smallest === left.diff && smallest <= leastDiff) {\n              leastDiff = left.diff;\n              pair = left.pair;\n            } else if (smallest === right.diff && smallest <= leastDiff) {\n              leastDiff = right.diff;\n              pair = right.pair;\n            }\n          }\n          const firstCaptain = poolForCaptains[pair[0]];\n          const secondCaptain = poolForCaptains[pair[1]];\n\n          if (firstCaptain.rating >= secondCaptain.rating) {\n            this.fillCaptainSpot(firstCaptain, 0);\n            this.fillCaptainSpot(secondCaptain, 1);\n          } else {\n            this.fillCaptainSpot(firstCaptain, 1);\n            this.fillCaptainSpot(secondCaptain, 0);\n          }\n        } else {\n          // 1 capt already there\n          const firstCaptain = this.players.find(u => u.captain !== null);\n          let leastDiff = 10000;\n          let otherCaptainIndex = null;\n          for (let i = 0; i < poolForCaptains.length; i++) {\n            const diff = Math.abs(\n              firstCaptain.rating - poolForCaptains[i].rating\n            );\n            if (diff <= leastDiff) {\n              leastDiff = diff;\n              otherCaptainIndex = i;\n            }\n          }\n\n          const otherCaptain = poolForCaptains[otherCaptainIndex];\n          console.log(otherCaptain, otherCaptainIndex);\n          const otherCaptainTeam = Math.abs((firstCaptain.team % 2) - 1);\n          this.fillCaptainSpot(otherCaptain, otherCaptainTeam);\n        }\n      } else {\n        // more than 2 capts\n        for (let i = 0; i < this.noOfTeams; i++) {\n          if (this.captains[i]) continue;\n          while (1) {\n            const pIndex = getRandomInt(0, poolForCaptains.length - 1);\n            const didFillSpot = this.fillCaptainSpot(\n              poolForCaptains[pIndex],\n              i\n            );\n            if (didFillSpot) break;\n          }\n        }\n      }\n\n      pugEventEmitter.emit(pugEvents.captainsReady, serverId, this.name);\n      //  TODO\n    }, captainTimeout);\n  }\n\n  addCaptain(user) {\n    let teamIndex;\n    while (1) {\n      teamIndex = getRandomInt(0, this.noOfTeams - 1);\n      const didFillSpot = this.fillCaptainSpot(user, teamIndex);\n      if (didFillSpot) break;\n    }\n\n    if (this.areCaptainsDecided()) clearTimeout(this.timer);\n    return {\n      team: teamIndex,\n      captainsDecided: this.areCaptainsDecided(),\n    };\n  }\n\n  fillCaptainSpot(user, teamIndex) {\n    const pIndex = this.players.findIndex(u => u.id === user.id);\n    if (this.players[pIndex].captain === null && !this.captains[teamIndex]) {\n      this.players[pIndex].captain = this.players[pIndex].team = teamIndex;\n      this.players[pIndex].pick = 0;\n      this.captains[teamIndex] = this.players[pIndex];\n      return true;\n    }\n    return false;\n  }\n\n  pickPlayer(playerIndex, team) {\n    if (this.players[playerIndex].team === null) {\n      this.players[playerIndex].team = team;\n      this.turn += 1;\n      this.players[playerIndex].pick = this.turn;\n\n      let pickedPlayers = [{ player: this.players[playerIndex], team }];\n      // last pick automatically goes\n      if (this.turn === this.pickingOrder.length - 1) {\n        const lastPlayerIndex = this.players.findIndex(u => u.team === null);\n        const lastPlayerTeam = this.pickingOrder[this.turn];\n\n        this.players[lastPlayerIndex].team = lastPlayerTeam;\n        this.turn += 1;\n        this.players[lastPlayerIndex].pick = this.turn;\n        // pug ends\n        this.picking = false;\n        pickedPlayers.push({\n          player: this.players[lastPlayerIndex],\n          team: lastPlayerTeam,\n        });\n        return {\n          pickedPlayers,\n          finished: true,\n        };\n      }\n      return {\n        pickedPlayers,\n        finished: false,\n      };\n    }\n  }\n\n  stopPug() {\n    this.cleanup();\n  }\n\n  findPlayer(user) {\n    return this.players.find(u => u.id === user.id);\n  }\n\n  isEmpty() {\n    return this.players.length === 0 ? true : false;\n  }\n\n  areCaptainsDecided() {\n    return this.captains.filter(Boolean).length === this.noOfTeams;\n  }\n\n  cleanup() {\n    //  TODO\n    this.picking = false;\n    this.turn = 0;\n    this.captains = [];\n    this.players.forEach(user => (user.captain = user.team = user.pick = null));\n    clearTimeout(this.timer);\n  }\n}\n\nexport const addGameType = async (\n  { channel },\n  [gameName, noOfPlayers, noOfTeams],\n  serverId,\n  { roles }\n) => {\n  try {\n    if (!hasPrivilegedRole(privilegedRoles, roles)) return;\n    if (isNaN(noOfPlayers) || isNaN(noOfTeams) || !gameName)\n      return channel.send('Invalid command');\n\n    const state = store.getState();\n    const { gameTypes } = state.pugs[serverId];\n\n    if (gameTypes.some(g => g.name === gameName.toLowerCase()))\n      return channel.send('Gametype already exists');\n\n    const pickingOrder = computePickingOrder(\n      parseInt(noOfPlayers),\n      parseInt(noOfTeams)\n    );\n\n    if (!pickingOrder)\n      return channel.send(\n        'Invalid No. of players/teams. Picking order cannot be computed'\n      );\n\n    const newGameType = {\n      name: gameName.toLowerCase(),\n      pickingOrder,\n      noOfPlayers: parseInt(noOfPlayers),\n      noOfTeams: parseInt(noOfTeams),\n    };\n\n    await GameTypes.findOneAndUpdate(\n      { server_id: serverId },\n      { $push: { game_types: newGameType } }\n    ).exec();\n    store.dispatch(\n      assignGameTypes({ serverId, gameTypes: [...game_types, newGameType] })\n    );\n\n    channel.send(`**${gameName}** has been added`);\n  } catch (error) {\n    channel.send('Something went wrong');\n    console.log(error);\n  }\n};\n\nexport const delGameType = async (\n  { channel },\n  [gameName, ...rest],\n  serverId,\n  { roles }\n) => {\n  try {\n    if (!hasPrivilegedRole(privilegedRoles, roles)) return;\n\n    const state = store.getState();\n    const { gameTypes } = state.pugs[serverId];\n\n    if (!gameTypes.some(g => g.name === gameName.toLowerCase()))\n      return channel.send(\"Gametype doesn't exist\");\n\n    const updatedGameTypes = gameTypes.filter(\n      g => g.name !== gameName.toLowerCase()\n    );\n\n    await GameTypes.findOneAndUpdate(\n      { server_id: serverId },\n      { game_types: updatedGameTypes }\n    ).exec();\n    store.dispatch(assignGameTypes({ serverId, gameTypes: updatedGameTypes }));\n\n    channel.send(`**${gameName}** has been removed`);\n  } catch (error) {\n    channel.send('Something went wrong');\n    console.log(error);\n  }\n};\n\nexport const listGameTypes = async ({ channel }, _, serverId, __) => {\n  try {\n    const state = store.getState();\n    const { pugChannel, gameTypes, list } = state.pugs[serverId];\n\n    if (pugChannel !== channel.id)\n      return channel.send(`Active channel for pugs is <#${pugChannel}>`);\n\n    const tempList = gameTypes.map(g => {\n      return {\n        name: g.name,\n        players: 0,\n        maxPlayers: g.noOfPlayers,\n      };\n    });\n\n    const gamesList = tempList.reduce((acc, curr) => {\n      const existingPug = list.find(p => p.name === curr.name);\n      if (existingPug) {\n        acc.push({\n          name: existingPug.name,\n          maxPlayers: existingPug.noOfPlayers,\n          players: existingPug.players.length,\n        });\n      } else {\n        acc.push(curr);\n      }\n      return acc;\n    }, []);\n\n    channel.send(formatListGameTypes(channel.guild.name, gamesList));\n  } catch (error) {\n    channel.send('Something went wrong');\n    console.log(error);\n  }\n};\n\nexport const listAllCurrentGameTypes = async ({ channel }, _, serverId, __) => {\n  try {\n    const state = store.getState();\n    const { pugChannel, list } = state.pugs[serverId];\n\n    if (pugChannel !== channel.id)\n      return channel.send(`Active channel for pugs is <#${pugChannel}>`);\n\n    channel.send(formatListAllCurrentGameTypes(list, channel.guild.name));\n  } catch (error) {\n    channel.send('Something went wrong');\n    console.log(error);\n  }\n};\n\nexport const joinGameTypes = async (\n  { channel },\n  args,\n  serverId,\n  { id, username, roles }\n) => {\n  try {\n    const state = store.getState();\n    const { pugChannel, list, gameTypes } = state.pugs[serverId];\n\n    if (pugChannel !== channel.id)\n      return channel.send(`Active channel for pugs is <#${pugChannel}>`);\n\n    // TODO args length 0 (default join with .j)\n\n    if (!id) return channel.send('No user was mentioned');\n\n    const isPartOfFilledPug = list.find(\n      p => p.picking && p.players.some(u => u.id === id)\n    );\n\n    if (isPartOfFilledPug)\n      return channel.send(\n        `Please leave **${isPartOfFilledPug.name.toUpperCase()}** first to join other pugs`\n      );\n\n    let toBroadcast = null;\n    const user = { id, username };\n    const statuses = args.map(a => {\n      if (!toBroadcast) {\n        const game = a.toLowerCase();\n        const gameType = gameTypes.find(g => g.name === game);\n\n        if (!gameType) return { user, name: game, joined: -1 }; // -1 is for NOT FOUND\n\n        const existingPug = list.find(p => p.name === game);\n        const pug = existingPug || new Pug(gameType);\n\n        const hasFilledBeforeJoining = pug.picking;\n        const joined = pug.addPlayer(user);\n        pug.players.length === pug.noOfPlayers ? pug.fillPug(serverId) : null;\n        const hasFilledAfterJoining = pug.picking;\n\n        if (!hasFilledBeforeJoining && hasFilledAfterJoining) {\n          toBroadcast = pug;\n        }\n\n        if (!existingPug && joined) {\n          store.dispatch(addNewPug({ serverId, newPug: pug }));\n        }\n\n        return {\n          user,\n          joined,\n          name: game,\n          activeCount: pug.players.length,\n          maxPlayers: pug.noOfPlayers,\n        };\n      }\n    });\n    channel.send(formatJoinStatus(statuses.filter(Boolean)));\n    if (toBroadcast) {\n      let allLeaveMsgs = ``;\n      for (let i = 0; i < list.length; i++) {\n        const op = list[i];\n        if (op.name !== toBroadcast.name) {\n          let allPugLeaveMsgs = ``;\n          for (let j = 0; j < toBroadcast.players.length; j++) {\n            const player = toBroadcast.players[j];\n            if (op.findPlayer(player)) {\n              const msg = await leaveGameTypes(\n                { channel },\n                [op.name],\n                serverId,\n                player,\n                null,\n                true\n              );\n              allPugLeaveMsgs += `${msg} `;\n            }\n          }\n          allLeaveMsgs += `${allPugLeaveMsgs} \\n`;\n        }\n      }\n\n      allLeaveMsgs && channel.send(allLeaveMsgs);\n      channel.send(formatBroadcastPug(toBroadcast));\n    }\n  } catch (error) {\n    channel.send('Something went wrong');\n    console.log(error);\n  }\n};\n\nexport const leaveGameTypes = async (\n  { channel },\n  args,\n  serverId,\n  { id, username, roles },\n  isOffline,\n  returnStatus\n) => {\n  try {\n    const state = store.getState();\n    const { pugChannel, list, gameTypes } = state.pugs[serverId];\n\n    if (pugChannel !== channel.id)\n      return channel.send(`Active channel for pugs is <#${pugChannel}>`);\n\n    if (!id) return channel.send('No user was mentioned');\n    if (args.length === 0)\n      return channel.send('Invalid, No pugs were mentioned');\n\n    const user = { id, username };\n    const statuses = args.map(a => {\n      const game = a.toLowerCase();\n      const gameType = gameTypes.find(g => g.name === game);\n\n      if (!gameType) return { user, name: game, left: -1 }; // -1 is for NOT FOUND\n\n      const pug = list.find(p => p.name === game);\n      const isInPug = pug && pug.findPlayer(user);\n      if (isInPug) {\n        pug.removePlayer(user);\n        return {\n          user,\n          pug,\n          name: game,\n          left: 1,\n          activeCount: pug.players.length,\n          maxPlayers: pug.noOfPlayers,\n        };\n      }\n      return { user, name: game, left: 0 };\n    });\n    // TODO Compute deadpugs\n    const deadPugs = statuses.reduce(\n      (acc, { user, pug, name, activeCount, maxPlayers }) => {\n        if (activeCount === maxPlayers - 1) {\n          acc.push({ pug, user });\n        }\n        if (pug && pug.isEmpty()) {\n          store.dispatch(removePug({ serverId, name }));\n        }\n        return acc;\n      },\n      []\n    );\n\n    const leaveStatus = formatLeaveStatus(statuses, isOffline);\n    if (returnStatus) return leaveStatus;\n\n    channel.send(leaveStatus);\n    deadPugs.length > 0 ? channel.send(formatDeadPugs(deadPugs)) : null;\n  } catch (error) {\n    channel.send('Something went wrong');\n    console.log(error);\n  }\n};\n\nexport const leaveAllGameTypes = async (message, args, serverId, user) => {\n  try {\n    const state = store.getState();\n    const { pugChannel, list } = state.pugs[serverId];\n\n    if (pugChannel !== message.channel.id)\n      return message.channel.send(\n        `Active channel for pugs is <#${pugChannel}>`\n      );\n\n    const hasGoneOffline = args[0] === offline;\n    const listToLeave = list.reduce((acc, pug) => {\n      const isInPug = pug.findPlayer(user);\n      if (isInPug) {\n        acc.push(pug.name);\n      }\n      return acc;\n    }, []);\n    if (listToLeave.length === 0) {\n      return channel.send(\n        `Cannot leave pug(s) if you haven't joined any :head_bandage:`\n      );\n    }\n    leaveGameTypes(message, listToLeave, serverId, user, hasGoneOffline);\n  } catch (error) {\n    message.channel.send('Something went wrong');\n    console.log(error);\n  }\n};\n\nexport const addCaptain = async (\n  { channel },\n  args,\n  serverId,\n  { id, username, roles }\n) => {\n  try {\n    const state = store.getState();\n    const { pugChannel, list } = state.pugs[serverId];\n\n    if (pugChannel !== channel.id)\n      return channel.send(`Active channel for pugs is <#${pugChannel}>`);\n\n    const forWhichPug = list.find(pug => {\n      const isCandidate = pug.picking && !pug.areCaptainsDecided();\n      if (isCandidate) {\n        return pug.players.some(u => u.id === id); // check whether the guy is present there\n      }\n      return false;\n    });\n\n    if (!forWhichPug)\n      return channel.send(\n        'There was no filled pug for which you could captain'\n      );\n\n    if (!forWhichPug.players.some(u => u.id === id && u.captain === null))\n      return channel.send(`**${username}** is already a captain`);\n\n    const user = { id, username };\n    const result = forWhichPug.addCaptain(user);\n    channel.send(formatAddCaptainStatus(user, result));\n    // TODO Broadcast captains decided\n    if (result.captainsDecided) {\n      // emit\n      pugEventEmitter.emit(pugEvents.captainsReady, serverId, forWhichPug.name);\n    }\n  } catch (error) {\n    channel.send('Something went wrong');\n    console.log(error);\n  }\n};\n\nexport const pickPlayer = async (\n  { channel },\n  [index, ...args],\n  serverId,\n  { id, username, roles }\n) => {\n  try {\n    const state = store.getState();\n    const { pugChannel, list } = state.pugs[serverId];\n\n    if (pugChannel !== channel.id)\n      return channel.send(`Active channel for pugs is <#${pugChannel}>`);\n\n    const playerIndex = parseInt(index);\n    if (!playerIndex) return;\n\n    const forWhichPug = list.find(pug => {\n      if (pug.picking) {\n        return pug.players.some(u => u.id === id && u.captain !== null); // check whether the guy is present there\n      }\n      return false;\n    });\n\n    if (!forWhichPug)\n      return channel.send(\n        'Cannot pick if you are not a captain in a pug :head_bandage: '\n      );\n\n    if (!forWhichPug.areCaptainsDecided())\n      return channel.send('Please wait until all captains have been decided');\n\n    const { team } = forWhichPug.players.find(\n      u => (u.id === id) & (u.captain !== null)\n    );\n    const { pickingOrder, turn, name } = forWhichPug;\n\n    if (team !== pickingOrder[turn])\n      return channel.send('Please wait for your turn :pouting_cat: ');\n\n    if (playerIndex < 1 || playerIndex > forWhichPug.players.length)\n      return channel.send('Invalid pick');\n\n    if (forWhichPug.players[playerIndex - 1].team !== null) {\n      const alreadyPicked = forWhichPug.players[playerIndex - 1];\n      return channel.send(`${alreadyPicked.username} is already picked`);\n    }\n\n    const result = forWhichPug.pickPlayer(playerIndex - 1, pickingOrder[turn]);\n    channel.send(formatPickPlayerStatus({ ...result, pug: forWhichPug }));\n\n    // TODO If finished, save stats to DB and remove from redux\n    if (result.finished) {\n      store.dispatch(removePug({ serverId, name }));\n    }\n  } catch (error) {\n    channel.send('Something went wrong');\n    console.log(error);\n  }\n};\n\nexport const pugPicking = async ({ channel }, _, serverId, __) => {\n  try {\n    const state = store.getState();\n    const { pugChannel, list } = state.pugs[serverId];\n\n    if (pugChannel !== channel.id)\n      return channel.send(`Active channel for pugs is <#${pugChannel}>`);\n\n    const pugsInPicking = list.filter(\n      pug => pug.picking && pug.areCaptainsDecided()\n    );\n\n    if (pugsInPicking.length === 0) {\n      return channel.send('There are no pugs in picking mode');\n    }\n\n    channel.send(formatPugsInPicking(pugsInPicking));\n  } catch (error) {\n    channel.send('Something went wrong');\n    console.log(error);\n  }\n};\n\n/**\n * A D M I N\n * C O M M A N D S\n */\n\nexport const adminAddPlayer = async (\n  { channel },\n  args,\n  serverId,\n  { mentionedUser, roles }\n) => {\n  try {\n    const state = store.getState();\n    const { pugChannel } = state.pugs[serverId];\n\n    if (pugChannel !== channel.id)\n      return channel.send(`Active channel for pugs is <#${pugChannel}>`);\n\n    if (!hasPrivilegedRole(privilegedRoles, roles)) return;\n    if (!mentionedUser) return channel.send('No mentioned user');\n\n    joinGameTypes({ channel }, args.slice(1), serverId, {\n      id: mentionedUser.id,\n      username: mentionedUser.username,\n    });\n  } catch (error) {\n    channel.send('Something went wrong');\n    console.log(error);\n  }\n};\n\nexport const adminRemovePlayer = async (\n  { channel },\n  args,\n  serverId,\n  { mentionedUser, roles }\n) => {\n  try {\n    const state = store.getState();\n    const { pugChannel } = state.pugs[serverId];\n\n    if (pugChannel !== channel.id)\n      return channel.send(`Active channel for pugs is <#${pugChannel}>`);\n\n    if (!hasPrivilegedRole(privilegedRoles, roles)) return;\n    if (!mentionedUser) return channel.send('No mentioned user');\n\n    leaveGameTypes({ channel }, args.slice(1), serverId, {\n      id: mentionedUser.id,\n      username: mentionedUser.username,\n    });\n  } catch (error) {\n    channel.send('Something went wrong');\n    console.log(error);\n  }\n};\n\nexport const adminPickPlayer = async (\n  { channel },\n  args,\n  serverId,\n  { mentionedUser, roles }\n) => {\n  try {\n    const state = store.getState();\n    const { pugChannel } = state.pugs[serverId];\n\n    if (pugChannel !== channel.id)\n      return channel.send(`Active channel for pugs is <#${pugChannel}>`);\n\n    if (!hasPrivilegedRole(privilegedRoles, roles)) return;\n    if (!mentionedUser) return channel.send('No mentioned user');\n\n    pickPlayer({ channel }, args.slice(1), serverId, {\n      id: mentionedUser.id,\n      username: mentionedUser.username,\n    });\n  } catch (error) {\n    channel.send('Something went wrong');\n    console.log(error);\n  }\n};\n"],"file":"pugHandlers.js"}